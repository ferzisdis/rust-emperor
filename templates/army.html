{% extends "base.html" %}

{% block title %}Army - {{ state.user_name }}{% endblock %}

{% block content %}
<div class="army-view">
    <div class="page-header">
        <h1>âš”ï¸ Army Recruitment</h1>
        <a href="/game" class="btn btn-secondary">â† Back to Game</a>
    </div>

    <!-- Resources Bar -->
    <div class="resources-bar">
        <div class="resource-item">
            <span class="resource-icon">ğŸ’°</span>
            <span class="resource-label">Gold:</span>
            <span class="resource-value">{{ state.gold }}</span>
        </div>
        <div class="resource-item">
            <span class="resource-icon">ğŸ‘¥</span>
            <span class="resource-label">Citizens:</span>
            <span class="resource-value">{{ state.man_quantity }}</span>
        </div>
        <div class="resource-item">
            <span class="resource-icon">âš”ï¸</span>
            <span class="resource-label">Soldiers:</span>
            <span class="resource-value">{{ state.soldier_quantity }}</span>
        </div>
        <div class="resource-item">
            <span class="resource-icon">ğŸ—¡ï¸</span>
            <span class="resource-label">Weapons:</span>
            <span class="resource-value">{{ state.weapon_quantity }}</span>
        </div>
    </div>

    <div class="page-content-grid">
        <div class="info-panel">
            <h2>Soldier Recruitment</h2>
            <p class="info-text">
                Recruit citizens into your army to protect your realm and expand your influence.
            </p>

            <div class="stats-card">
                <div class="stat-row">
                    <span class="stat-label">ğŸ“Š Recruitment Cost:</span>
                    <span class="stat-value">{{ state.soldier_price }} gold per soldier</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">ğŸ—¡ï¸ Weapons Required:</span>
                    <span class="stat-value">1 weapon per soldier</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">ğŸ‘¥ Citizens Required:</span>
                    <span class="stat-value">1 citizen per soldier</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">âš ï¸ Minimum Citizens:</span>
                    <span class="stat-value">Must keep at least 200 citizens</span>
                </div>
            </div>

            <div class="available-card">
                <p></p><strong>Available to recruit:</strong></p>
                <ul>
                    <li>Maximum by gold: {{ state.max_recruitable_by_gold() }}</li>
                    <li>Maximum by weapons: {{ state.weapon_quantity }}</li>
                    <li>Maximum by citizens: {{ state.max_recruitable_by_citizens() }}</li>
                </ul>
            </div>
        </div>

        <div class="actions-panel">
            <!-- Recruit Soldiers -->
            <div class="action-card">
                <h3>âš”ï¸ Recruit Soldiers</h3>
                <p class="action-description">
                    Convert citizens into soldiers. Each soldier requires 1 weapon and costs {{ state.soldier_price }} gold.
                </p>

                <form hx-post="/game/army/recruit" hx-target="body" hx-swap="innerHTML" class="action-form">
                    <div class="form-group">
                        <label for="recruit_quantity">Quantity to recruit:</label>
                        <input
                            type="number"
                            id="recruit_quantity"
                            name="quantity"
                            min="1"
                            max="1000"
                            value="1"
                            class="form-input"
                            required
                        />
                    </div>

                    <div class="quick-select">
                        <span class="quick-label">Quick select:</span>
                        <button type="button" class="btn-quick" onclick="document.getElementById('recruit_quantity').value='1'">1</button>
                        <button type="button" class="btn-quick" onclick="document.getElementById('recruit_quantity').value='10'">10</button>
                        <button type="button" class="btn-quick" onclick="document.getElementById('recruit_quantity').value='50'">50</button>
                        <button type="button" class="btn-quick" onclick="document.getElementById('recruit_quantity').value='100'">100</button>
                    </div>

                    <button
                        type="submit"
                        class="btn btn-primary btn-large"
                        {% if state.man_quantity <= 200 || state.weapon_quantity == 0 || !state.can_afford_soldier() %}disabled{% endif %}>
                        ğŸ–ï¸ Recruit Soldiers
                    </button>
                </form>
            </div>

            <!-- Discharge Soldiers -->
            <div class="action-card">
                <h3>ğŸ  Discharge Soldiers</h3>
                <p class="action-description">
                    Return soldiers to civilian life. You'll receive a refund of {{ state.soldier_price }} gold per soldier and recover their weapons.
                </p>

                <form hx-post="/game/army/discharge" hx-target="body" hx-swap="innerHTML" class="action-form">
                    <div class="form-group">
                        <label for="discharge_quantity">Quantity to discharge:</label>
                        <input
                            type="number"
                            id="discharge_quantity"
                            name="quantity"
                            min="1"
                            max="{{ state.soldier_quantity }}"
                            value="1"
                            class="form-input"
                            required
                        />
                    </div>

                    <div class="quick-select">
                        <span class="quick-label">Quick select:</span>
                        <button type="button" class="btn-quick" onclick="document.getElementById('discharge_quantity').value='1'">1</button>
                        <button type="button" class="btn-quick" onclick="document.getElementById('discharge_quantity').value='10'">10</button>
                        <button type="button" class="btn-quick" onclick="document.getElementById('discharge_quantity').value='50'">50</button>
                        <button type="button" class="btn-quick" onclick="document.getElementById('discharge_quantity').value='{{ state.soldier_quantity }}'">All</button>
                    </div>

                    <button
                        type="submit"
                        class="btn btn-secondary btn-large"
                        {% if state.soldier_quantity == 0 %}disabled{% endif %}>
                        ğŸ  Discharge Soldiers
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="help-panel">
        <h3>ğŸ’¡ Tips</h3>
        <ul class="help-list">
            <li><strong>Soldiers are essential</strong> for advancing to higher ranks. Check your grade requirements!</li>
            <li><strong>Weapons are produced</strong> by smithies from iron. Build more smithies to increase weapon production.</li>
            <li><strong>Iron comes from mines</strong> or can be purchased at the market (requires 5+ markets).</li>
            <li><strong>Keep enough citizens</strong> to maintain your economy. You must always have at least 200 citizens.</li>
            <li><strong>Soldiers can be affected by events</strong> such as desertions, attacks, or celebrations.</li>
        </ul>
    </div>
</div>
{% endblock %}