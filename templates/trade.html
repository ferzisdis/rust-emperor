{% extends "base.html" %}

{% block title %}Trade - {{ state.user_name }}{% endblock %}

{% block content %}
<div class="game-view">
    <div class="game-header">
        <div class="player-info">
            <h1>ğŸ’± Trade Market</h1>
            <p class="year">{{ state.get_grade_title() }} {{ state.user_name }} - Year {{ state.year }}</p>
        </div>
    </div>

    <!-- Resources Bar -->
    <div class="resources-bar">
        <div class="resource-item">
            <span class="resource-icon">ğŸ’°</span>
            <span class="resource-label">Gold:</span>
            <span class="resource-value">{{ state.gold }}</span>
        </div>
        <div class="resource-item">
            <span class="resource-icon">ğŸŒ¾</span>
            <span class="resource-label">Food:</span>
            <span class="resource-value">{{ state.food_quantity }}</span>
        </div>
        <div class="resource-item">
            <span class="resource-icon">âš™ï¸</span>
            <span class="resource-label">Iron:</span>
            <span class="resource-value">{{ state.iron_quantity }}</span>
        </div>
        <div class="resource-item">
            <span class="resource-icon">âš”ï¸</span>
            <span class="resource-label">Weapons:</span>
            <span class="resource-value">{{ state.weapon_quantity }}</span>
        </div>
        <div class="resource-item">
            <span class="resource-icon">ğŸª</span>
            <span class="resource-label">Markets:</span>
            <span class="resource-value">{{ state.market_quantity }}</span>
        </div>
    </div>

    <div class="trade-content">
        {% if state.market_quantity == 0 %}
        <div class="panel trade-unavailable">
            <h2>ğŸš« Trading Unavailable</h2>
            <p>You need to build at least one market to access trading!</p>
            <a href="/game" class="btn btn-large">â¬…ï¸ Back to Game</a>
        </div>
        {% else %}
        <div class="trade-options">
            <!-- Food Trading -->
            <div class="panel trade-panel">
                <h3>ğŸŒ¾ Food Rations</h3>
                <div class="trade-info">
                    <p><strong>Price:</strong> {{ state.price_for_food }} gold per 100 units</p>
                    <p><strong>Your Food:</strong> {{ state.food_quantity }}</p>
                    <p class="hint">Trade food in multiples of 100</p>
                </div>
                <div class="trade-actions">
                    <form hx-post="/game/trade/buy-food" hx-target="body" hx-swap="innerHTML" class="trade-form">
                        <label for="buy_food_quantity">Buy Food:</label>
                        <select name="quantity" id="buy_food_quantity" class="trade-select">
                            <option value="100">100 ({{ state.price_for_food }} ğŸ’°)</option>
                            <option value="1000">1,000 ({{ state.price_for_food * 10 }} ğŸ’°)</option>
                            <option value="10000">10,000 ({{ state.price_for_food * 100 }} ğŸ’°)</option>
                            <option value="100000">100,000 ({{ state.price_for_food * 1000 }} ğŸ’°)</option>
                        </select>
                        <button type="submit" class="btn btn-buy">Buy</button>
                    </form>
                    <form hx-post="/game/trade/sell-food" hx-target="body" hx-swap="innerHTML" class="trade-form">
                        <label for="sell_food_quantity">Sell Food:</label>
                        <select name="quantity" id="sell_food_quantity" class="trade-select">
                            <option value="100">100 ({{ state.price_for_food }} ğŸ’°)</option>
                            <option value="1000">1,000 ({{ state.price_for_food * 10 }} ğŸ’°)</option>
                            <option value="10000">10,000 ({{ state.price_for_food * 100 }} ğŸ’°)</option>
                            <option value="100000">100,000 ({{ state.price_for_food * 1000 }} ğŸ’°)</option>
                        </select>
                        <button type="submit" class="btn btn-sell">Sell</button>
                    </form>
                </div>
            </div>

            <!-- Iron Trading -->
            {% if state.market_quantity > 4 %}
            <div class="panel trade-panel">
                <h3>âš™ï¸ Iron</h3>
                <div class="trade-info">
                    <p><strong>Price:</strong> {{ state.price_for_armor }} gold per unit</p>
                    <p><strong>Your Iron:</strong> {{ state.iron_quantity }}</p>
                    <p><strong>Trade Limit:</strong> {{ state.trade_limit }}</p>
                </div>
                <div class="trade-actions">
                    <form hx-post="/game/trade/buy-iron" hx-target="body" hx-swap="innerHTML" class="trade-form">
                        <label for="buy_iron_quantity">Buy Iron:</label>
                        <select name="quantity" id="buy_iron_quantity" class="trade-select">
                            <option value="1">1 ({{ state.price_for_armor }} ğŸ’°)</option>
                            <option value="10">10 ({{ state.price_for_armor * 10 }} ğŸ’°)</option>
                            <option value="100">100 ({{ state.price_for_armor * 100 }} ğŸ’°)</option>
                            <option value="1000">1,000 ({{ state.price_for_armor * 1000 }} ğŸ’°)</option>
                        </select>
                        <button type="submit" class="btn btn-buy">Buy</button>
                    </form>
                </div>
            </div>
            {% else %}
            <div class="panel trade-panel trade-locked">
                <h3>ğŸ”’ Iron Trading Locked</h3>
                <p>Build more than 4 markets to unlock iron trading.</p>
                <p class="hint">Current markets: {{ state.market_quantity }} / 5 needed</p>
            </div>
            {% endif %}

            <!-- Weapons Trading -->
            {% if state.market_quantity > 9 %}
            <div class="panel trade-panel">
                <h3>âš”ï¸ Weapons</h3>
                <div class="trade-info">
                    <p><strong>Price:</strong> {{ state.price_for_weapon }} gold per unit</p>
                    <p><strong>Your Weapons:</strong> {{ state.weapon_quantity }}</p>
                    <p><strong>Trade Limit:</strong> {{ state.trade_limit }}</p>
                </div>
                <div class="trade-actions">
                    <form hx-post="/game/trade/buy-weapons" hx-target="body" hx-swap="innerHTML" class="trade-form">
                        <label for="buy_weapons_quantity">Buy Weapons:</label>
                        <select name="quantity" id="buy_weapons_quantity" class="trade-select">
                            <option value="1">1 ({{ state.price_for_weapon }} ğŸ’°)</option>
                            <option value="10">10 ({{ state.price_for_weapon * 10 }} ğŸ’°)</option>
                            <option value="100">100 ({{ state.price_for_weapon * 100 }} ğŸ’°)</option>
                            <option value="1000">1,000 ({{ state.price_for_weapon * 1000 }} ğŸ’°)</option>
                        </select>
                        <button type="submit" class="btn btn-buy">Buy</button>
                    </form>
                </div>
            </div>
            {% else %}
            <div class="panel trade-panel trade-locked">
                <h3>ğŸ”’ Weapons Trading Locked</h3>
                <p>Build more than 9 markets to unlock weapons trading.</p>
                <p class="hint">Current markets: {{ state.market_quantity }} / 10 needed</p>
            </div>
            {% endif %}
        </div>

        <div class="trade-footer">
            <a href="/game" class="btn btn-large">â¬…ï¸ Back to Game</a>
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}